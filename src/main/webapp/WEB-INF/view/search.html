<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–∏—Å–∫ –ø–æ–≥–æ–¥—ã</title>

    <!-- Bootstrap / Icons / Google-fonts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- üü¢ –û–ë–©–ò–ï –°–¢–ò–õ–ò –î–õ–Ø –í–°–ï–• –°–¢–†–ê–ù–ò–¶ -->
    <link th:href="@{resources/css/weather-style.css}" rel="stylesheet">
</head>
<body>

<!-- ‚îÄ‚îÄ‚îÄ –®–∞–ø–∫–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<header class="bg-primary text-white p-3">
    <div class="container d-flex justify-content-between align-items-center">
        <h1 class="mb-0">
            <a th:href="@{/home}" class="text-white text-decoration-none">–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–≥–æ–¥—ã</a>
        </h1>

        <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
        <form th:action="@{/search_location}" method="post" class="d-flex align-items-center gap-2">
            <input type="text" name="cityName" class="form-control"
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞" th:value="${cityName}" required>

            <!-- –í—ã–±–æ—Ä API -->
            <div class="btn-group me-2">
                <button type="button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown">–í—ã–±–µ—Ä–∏—Ç–µ API</button>
                <ul class="dropdown-menu p-3" style="min-width:250px">
                    <li class="form-check">
                        <input class="form-check-input" type="checkbox" name="sources" value="WeatherRepository"
                               th:checked="${#lists.contains(selectedSources,'WeatherRepository')}" id="api1">
                        <label class="form-check-label" for="api1">OpenWeather</label>
                    </li>
                    <li class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" name="sources" value="WeatherAPIRepository"
                               th:checked="${#lists.contains(selectedSources,'WeatherAPIRepository')}" id="api2">
                        <label class="form-check-label" for="api2">WeatherAPI</label>
                    </li>
                    <li class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" name="sources" value="WeatherAPIRepository"
                               th:checked="${#lists.contains(selectedSources,'VCWeatherRepository')}" id="api3">
                        <label class="form-check-label" for="api2">VCWeatherAPI</label>
                    </li>
                </ul>
            </div>

            <button type="submit" class="btn btn-light">–ù–∞–π—Ç–∏</button>
        </form>
    </div>
</header>

<!-- ‚îÄ‚îÄ‚îÄ –ö–æ–Ω—Ç–µ–Ω—Ç ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<main class="container mt-5 flex-grow-1">

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ -->
    <div th:if="${error}" class="alert alert-danger" role="alert">
        <span th:text="${error}"></span>
    </div>

    <!-- –û—à–∏–±–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö API -->
    <div th:if="${errorsByApi!=null}">
        <div th:each="e:${errorsByApi}">
            <div class="alert alert-danger" role="alert">
                –û—à–∏–±–∫–∞ –≤ API <strong th:text="${e.key}"></strong>: <span th:text="${e.value}"></span>
            </div>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div th:if="${resultsByApi!=null}">
        <div th:each="entry:${resultsByApi}">
            <h3 class="text-dark mb-4" th:text="'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è API: '+${entry.key}"></h3>

            <div class="row">
                <div class="col-md-4 mb-4" th:each="weather:${entry.value}">
                    <div class="card weather-card d-flex flex-column text-center p-4 h-100">

                        <div class="weather-icon-wrap">
                            <img th:src="${weather.weatherDetails[0].icon}" alt="icon">
                        </div>

                        <h5 class="mb-3" th:text="${weather.name}">–ì–æ—Ä–æ–¥</h5>

                        <div class="card p-3 shadow-sm mx-auto" style="max-width:330px">
                            <table class="table table-borderless table-sm mb-0">
                                <tbody>
                                <tr><td class="text-end"><i class="bi bi-thermometer-half"></i></td>
                                    <td class="text-start">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</td>
                                    <td><strong th:text="${weather.parameters.temp} + ' ¬∞C'"></strong></td></tr>
                                <tr><td class="text-end text-primary"><i class="bi bi-droplet"></i></td>
                                    <td class="text-start">–í–ª–∞–∂–Ω–æ—Å—Ç—å:</td>
                                    <td><strong th:text="${weather.parameters.humidity} + '%'"></strong></td></tr>
                                <tr><td class="text-end"><i class="bi bi-wind"></i></td>
                                    <td class="text-start">–í–µ—Ç–µ—Ä:</td>
                                    <td><strong th:text="${weather.wind.speed} + ' –º/—Å'"></strong></td></tr>
                                <tr><td class="text-end"><i class="bi bi-cloud"></i></td>
                                    <td class="text-start">–°–æ—Å—Ç–æ—è–Ω–∏–µ:</td>
                                    <td><strong th:text="${weather.weatherDetails[0].main}"></strong></td></tr>
                                <tr><td class="text-end text-danger"><i class="bi bi-card-text"></i></td>
                                    <td class="text-start">–û–ø–∏—Å–∞–Ω–∏–µ:</td>
                                    <td><strong th:text="${weather.weatherDetails[0].description}"></strong></td></tr>
                                </tbody>
                            </table>
                        </div>

                        <form th:action="@{/save_location}" method="post" class="mt-4">
                            <input type="hidden" name="name" th:value="${weather.name}">
                            <input type="hidden" name="lat"  th:value="${weather.coordinates.lat}">
                            <input type="hidden" name="lon"  th:value="${weather.coordinates.lon}">
                            <button type="submit" class="btn btn-outline-success w-100">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </form>
                    </div>
                </div>
            </div>

            <hr class="text-white"/>
        </div>
    </div>

    <p th:if="${resultsByApi==null || resultsByApi.isEmpty()}"
       class="text-black fs-4 text-center">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
</main>

<!-- ‚îÄ‚îÄ‚îÄ –§—É—Ç–µ—Ä ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<footer class="mt-auto py-4">
    <div class="container d-lg-flex justify-content-between align-items-center text-center">
        <p class="mb-3 mb-lg-0 fw-light small">
            –î–∏–ø–ª–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞, 2025 –≥.<br>
            –ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç<br>
            –Æ–≥–æ-–û—Å–µ—Ç–∏–Ω—Å–∫–∏–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏–º.&nbsp;–ê.&nbsp;–ê.&nbsp;–¢–∏–±–∏–ª–æ–≤–∞
        </p>

        <a class="me-lg-4 d-flex align-items-center gap-2"
           href="https://www.xipu.ru/" target="_blank" rel="noopener">
            <img th:src="@{/resources/img/hipu-logo.png}" alt="–õ–æ–≥–æ—Ç–∏–ø –Æ–û–ì–£"
                 width="48" height="48" style="border-radius:50%">
            xipu.ru
        </a>

        <a href="https://github.com/slavik-gassiev/weather_hipu"
           target="_blank" rel="noopener"
           class="d-flex align-items-center gap-2">
            <i class="bi bi-github fs-5"></i>
            github.com/slavik-gassiev/weather_hipu
        </a>
    </div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
