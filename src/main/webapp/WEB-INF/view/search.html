<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–∏—Å–∫ –ø–æ–≥–æ–¥—ã</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- jQuery (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Bootstrap Select -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>


</head>
<body>
<header class="bg-primary text-white p-3">
    <div class="container d-flex justify-content-between align-items-center">
        <h1 class="mb-0">
            <a th:href="@{/home}" class="text-white text-decoration-none">
                –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–≥–æ–¥—ã
            </a>
        </h1>
        <form th:action="@{/search_location}" method="post" class="d-flex align-items-center gap-2">
            <input type="text" name="cityName" class="form-control"
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞"
                   th:value="${cityName}" required>

            <!-- API –í—ã–±–æ—Ä -->
            <div class="btn-group me-2">
                <button type="button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    –í—ã–±–µ—Ä–∏—Ç–µ API
                </button>
                <ul class="dropdown-menu p-3" style="min-width: 250px;">
                    <li>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="sources" value="WeatherRepository"
                                   th:checked="${#lists.contains(selectedSources, 'WeatherRepository')}" id="weatherRepo">
                            <label class="form-check-label" for="weatherRepo">OpenWeather</label>
                        </div>
                    </li>
                    <li>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="sources" value="WeatherAPIRepository"
                                   th:checked="${#lists.contains(selectedSources, 'WeatherAPIRepository')}" id="weatherApiRepo">
                            <label class="form-check-label" for="weatherApiRepo">WeatherAPI</label>
                        </div>
                    </li>
                    <!-- –ò –¥–∞–ª—å—à–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë API! -->
                </ul>
            </div>


            <button type="submit" class="btn btn-light">
                –ù–∞–π—Ç–∏
            </button>
        </form>
    </div>
</header>

<!-- ‚îÄ‚îÄ‚îÄ –ö–æ–Ω—Ç–µ–Ω—Ç (–∑–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π <main>‚Ä¶</main>) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<main class="container mt-5 flex-grow-1">

    <!-- –û—à–∏–±–∫–∏ -->
    <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>

    <div th:if="${errorsByApi}">
        <div th:each="e : ${errorsByApi}" class="alert alert-danger" role="alert">
            –û—à–∏–±–∫–∞ –≤ API <strong th:text="${e.key}"></strong>:
            <span th:text="${e.value}"></span>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div th:if="${resultsByApi}">
        <div th:each="entry : ${resultsByApi}">
            <h4 class="text-white mb-4" th:text="'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è API: ' + ${entry.key}"></h4>

            <div class="row g-4">
                <!-- –ö–ê–†–¢–û–ß–ö–ê –∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
                <div class="col-md-4" th:each="weather : ${entry.value}">
                    <div class="card weather-card d-flex flex-column text-center p-4 h-100">

                        <div class="weather-icon-wrap">
                            <img th:src="${weather.weatherDetails[0].icon}" alt="icon">
                        </div>

                        <h5 class="mb-3" th:text="${weather.name}">–ì–æ—Ä–æ–¥</h5>

                        <table class="table table-borderless table-sm mb-3 text-start">
                            <tbody>
                            <tr><td>üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</td><td th:text="${weather.parameters.temp} + ' ¬∞C'"></td></tr>
                            <tr><td>üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å:</td><td th:text="${weather.parameters.humidity} + '%'"></td></tr>
                            <tr><td>üå¨ –í–µ—Ç–µ—Ä:</td><td th:text="${weather.wind.speed} + ' –º/—Å'"></td></tr>
                            <tr><td>üå§ –°–æ—Å—Ç–æ—è–Ω–∏–µ:</td><td th:text="${weather.weatherDetails[0].main}"></td></tr>
                            <tr><td>üìù –û–ø–∏—Å–∞–Ω–∏–µ:</td><td th:text="${weather.weatherDetails[0].description}"></td></tr>
                            </tbody>
                        </table>

                        <form th:action="@{/save_location}" method="post" class="mt-auto">
                            <input type="hidden" name="name" th:value="${weather.name}">
                            <input type="hidden" name="lat"  th:value="${weather.coordinates.lat}">
                            <input type="hidden" name="lon"  th:value="${weather.coordinates.lon}">
                            <button type="submit" class="btn btn-primary w-100 rounded-0">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </form>
                    </div>
                </div>
            </div>

            <hr class="border-light my-5">
        </div>
    </div>

    <p th:if="${resultsByApi == null || resultsByApi.isEmpty()}"
       class="text-white fs-4 text-center">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
</main>


<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- Bootstrap Bundle (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è dropdown) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Bootstrap Select -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        $('.selectpicker').selectpicker({
            style: 'btn-light',
            size: 4
        });
    });
</script>


</body>
</html>
